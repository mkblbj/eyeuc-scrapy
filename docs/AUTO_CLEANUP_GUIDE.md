# ğŸ§¹ è‡ªåŠ¨æ¸…ç†åŠŸèƒ½æŒ‡å—

## æ¦‚è¿°

ä¸ºäº†é˜²æ­¢ `per_list_output` æ–‡ä»¶å¤¹å› ç´¯ç§¯å¤§é‡å·²å¯¼å…¥çš„ JSONL æ–‡ä»¶è€Œå ç”¨è¿‡å¤šç£ç›˜ç©ºé—´ï¼Œå¯¼å…¥è„šæœ¬ç°åœ¨æ”¯æŒ**è‡ªåŠ¨æ¸…ç†**åŠŸèƒ½ã€‚

---

## åŠŸèƒ½ç‰¹æ€§

### âœ… é»˜è®¤è¡Œä¸º

å¯¼å…¥è„šæœ¬ **é»˜è®¤å¼€å¯è‡ªåŠ¨æ¸…ç†**ï¼Œåœ¨æˆåŠŸå¯¼å…¥æ•°æ®åˆ° MySQL åï¼Œä¼šè‡ªåŠ¨ï¼š

1. **åˆ é™¤å·²å¯¼å…¥çš„ JSONL æ–‡ä»¶**
2. **æ£€æŸ¥ç›®å½•æ˜¯å¦ä¸ºç©º**ï¼Œå¦‚æœä¸ºç©ºåˆ™åˆ é™¤ç›®å½•
3. **ä»…æ¸…ç†æˆåŠŸå¯¼å…¥çš„æ–‡ä»¶**

### ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶

- âœ… **åªåœ¨å¯¼å…¥æˆåŠŸåæ¸…ç†**ï¼šå¦‚æœå¯¼å…¥å¤±è´¥ï¼Œæ–‡ä»¶å°†è¢«ä¿ç•™
- âœ… **åªæ¸…ç†å·²å¯¼å…¥çš„æ–‡ä»¶**ï¼šä¸ä¼šè¯¯åˆ å…¶ä»–æ–‡ä»¶
- âœ… **æ™ºèƒ½ç›®å½•ç®¡ç†**ï¼šåªåˆ é™¤ç©ºç›®å½•
- âœ… **å¯ç¦ç”¨**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡ `CLEANUP=false` ç¦ç”¨æ¸…ç†

---

## ä½¿ç”¨æ–¹æ³•

### 1. é»˜è®¤ä½¿ç”¨ï¼ˆæ¨èï¼‰

```bash
# è‡ªåŠ¨æ¸…ç†å·²å¯¼å…¥çš„æ–‡ä»¶
python scripts/import_eyeuc_jsonl_to_mysql.py "per_list_output/eyeuc_list193_*.jsonl"
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸ“ æ‰¾åˆ° 3 ä¸ªæ–‡ä»¶:
  - eyeuc_list193_p1-5_20251024_100000.jsonl
  - eyeuc_list193_p6-10_20251024_100001.jsonl
  - eyeuc_list193_merged_20251024_100002.jsonl

ğŸ”Œ è¿æ¥æ•°æ®åº“...
âœ… å·²è¿æ¥: 162.43.7.144:3306/eyeuc

ğŸ“„ å¤„ç†: eyeuc_list193_p1-5_20251024_100000.jsonl
  âœ… å®Œæˆ: 125 items

ğŸ“„ å¤„ç†: eyeuc_list193_p6-10_20251024_100001.jsonl
  âœ… å®Œæˆ: 103 items

ğŸ“„ å¤„ç†: eyeuc_list193_merged_20251024_100002.jsonl
  âœ… å®Œæˆ: 228 items

================================================================================
ğŸ‰ å¯¼å…¥å®Œæˆ!
================================================================================
  æ€» items: 228
  æ€»æ–‡ä»¶: 3
  ç”¨æ—¶: 5.23s
  é€Ÿåº¦: 43.6 items/s
================================================================================

ğŸ§¹ æ¸…ç†å·²å¯¼å…¥çš„æ–‡ä»¶...
  âœ… åˆ é™¤: eyeuc_list193_p1-5_20251024_100000.jsonl
  âœ… åˆ é™¤: eyeuc_list193_p6-10_20251024_100001.jsonl
  âœ… åˆ é™¤: eyeuc_list193_merged_20251024_100002.jsonl
  ğŸ“ ç›®å½•å·²ç©ºï¼Œåˆ é™¤: per_list_output
âœ¨ æ¸…ç†å®Œæˆ
```

---

### 2. ç¦ç”¨è‡ªåŠ¨æ¸…ç†

å¦‚æœä½ éœ€è¦ä¿ç•™æºæ–‡ä»¶ï¼ˆä¾‹å¦‚å¤‡ä»½æˆ–è°ƒè¯•ï¼‰ï¼Œå¯ä»¥ç¦ç”¨æ¸…ç†ï¼š

```bash
# æ–¹æ³• 1ï¼šç¯å¢ƒå˜é‡
CLEANUP=false python scripts/import_eyeuc_jsonl_to_mysql.py "per_list_output/*.jsonl"

# æ–¹æ³• 2ï¼šåœ¨ .env æ–‡ä»¶ä¸­è®¾ç½®
echo "CLEANUP=false" >> .env
source .env
python scripts/import_eyeuc_jsonl_to_mysql.py "per_list_output/*.jsonl"
```

---

## æ¸…ç†é€»è¾‘è¯¦è§£

### æ¸…ç†æ—¶æœº

```python
# åªæœ‰åœ¨ä»¥ä¸‹æ¡ä»¶åŒæ—¶æ»¡è¶³æ—¶æ‰æ¸…ç†ï¼š
1. å¯¼å…¥æˆåŠŸï¼ˆimport_success = Trueï¼‰
2. è‡ªåŠ¨æ¸…ç†å¼€å¯ï¼ˆauto_cleanup = Trueï¼‰
3. æ•°æ®åº“äº‹åŠ¡æˆåŠŸæäº¤ï¼ˆconn.commit()ï¼‰
```

### æ¸…ç†èŒƒå›´

```python
# æ¸…ç†çš„æ–‡ä»¶ï¼š
- å½“å‰å¯¼å…¥è„šæœ¬å¤„ç†çš„æ‰€æœ‰ JSONL æ–‡ä»¶
- ç”± glob æ¨¡å¼åŒ¹é…çš„æ–‡ä»¶

# ä¸ä¼šæ¸…ç†ï¼š
- å¯¼å…¥å¤±è´¥çš„æ–‡ä»¶
- ä¸åœ¨å½“å‰å¯¼å…¥åˆ—è¡¨ä¸­çš„æ–‡ä»¶
- é JSONL æ–‡ä»¶
- å…¶ä»–ç›®å½•ä¸­çš„æ–‡ä»¶
```

### ç›®å½•ç®¡ç†

```python
# æ¸…ç†æ–‡ä»¶åæ£€æŸ¥ç›®å½•ï¼š
if ç›®å½•ä¸ºç©º:
    åˆ é™¤ç›®å½•
else:
    ä¿ç•™ç›®å½•ï¼ˆæ˜¾ç¤ºå‰©ä½™æ–‡ä»¶æ•°é‡ï¼‰
```

---

## åœ¨è‡ªåŠ¨åŒ–ä»»åŠ¡ä¸­ä½¿ç”¨

### å®šæ—¶ä»»åŠ¡ï¼ˆautomation/run_scheduled_crawls.shï¼‰

è‡ªåŠ¨åŒ–è„šæœ¬å·²é»˜è®¤å¯ç”¨æ¸…ç†åŠŸèƒ½ï¼š

```bash
#!/bin/bash
# run_scheduled_crawls.sh

function run_list() {
  local list_id=$1
  local pages=$2
  
  # 1. çˆ¬å–æ•°æ®
  bash smart_crawl.sh "$list_id" "$pages"
  
  # 2. å¯¼å…¥æ•°æ®åº“ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
  python3 scripts/import_eyeuc_jsonl_to_mysql.py \
    "$(ls -t per_list_output/eyeuc_list${list_id}_*_merged_*.jsonl | head -1)"
  
  # âœ… å¯¼å…¥æˆåŠŸåï¼Œæºæ–‡ä»¶å·²è‡ªåŠ¨æ¸…ç†
}

run_list 182 100
run_list 193 50
```

**å¥½å¤„**ï¼š
- âœ… æ¯æ¬¡å®šæ—¶ä»»åŠ¡åè‡ªåŠ¨æ¸…ç†
- âœ… é˜²æ­¢ç£ç›˜ç©ºé—´ç´¯ç§¯
- âœ… æ— éœ€æ‰‹åŠ¨ç»´æŠ¤

---

## é…ç½®ç¤ºä¾‹

### .env æ–‡ä»¶é…ç½®

```bash
# æ•°æ®åº“è¿æ¥
MYSQL_HOST=162.43.7.144
MYSQL_PORT=3306
MYSQL_USER=eyeuc
MYSQL_PASSWORD=your_password
MYSQL_DATABASE=eyeuc
MYSQL_SSL=false

# è‡ªåŠ¨æ¸…ç†ï¼ˆé»˜è®¤ trueï¼‰
CLEANUP=true  # æˆ– false ç¦ç”¨æ¸…ç†
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæ–‡ä»¶æ²¡æœ‰è¢«æ¸…ç†

**å¯èƒ½åŸå› **ï¼š
1. å¯¼å…¥å¤±è´¥ï¼ˆæ£€æŸ¥æ—¥å¿—ä¸­çš„ "âŒ" æ ‡è®°ï¼‰
2. `CLEANUP=false` è¢«è®¾ç½®
3. æ–‡ä»¶æƒé™é—®é¢˜

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $CLEANUP

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -lh per_list_output/

# æ‰‹åŠ¨æ¸…ç†
rm per_list_output/*.jsonl
```

---

### é—®é¢˜ 2ï¼šç›®å½•æ²¡æœ‰è¢«åˆ é™¤

**å¯èƒ½åŸå› **ï¼š
- ç›®å½•ä¸ä¸ºç©ºï¼ˆè¿˜æœ‰å…¶ä»–æ–‡ä»¶ï¼‰

**æ£€æŸ¥**ï¼š
```bash
# æŸ¥çœ‹ç›®å½•å†…å®¹
ls -la per_list_output/

# æŸ¥çœ‹å‰©ä½™æ–‡ä»¶
find per_list_output/ -type f
```

---

### é—®é¢˜ 3ï¼šæƒ³æ¢å¤å·²åˆ é™¤çš„æ–‡ä»¶

**å»ºè®®**ï¼š
1. **é¢„é˜²**ï¼šåœ¨é¦–æ¬¡å¯¼å…¥å‰å¤‡ä»½é‡è¦æ•°æ®
   ```bash
   # å¤‡ä»½ JSONL æ–‡ä»¶
   cp -r per_list_output per_list_output_backup
   ```

2. **é‡æ–°çˆ¬å–**ï¼š
   ```bash
   # é‡æ–°çˆ¬å–æŒ‡å®šåˆ—è¡¨
   bash batch_crawl.sh 193 5 cookies.json
   ```

3. **ä»æ•°æ®åº“å¯¼å‡º**ï¼ˆå¦‚æœå·²å¯¼å…¥ï¼‰ï¼š
   ```bash
   # å¯ä»¥ä» MySQL é‡æ–°å¯¼å‡ºæ•°æ®
   python scripts/export_database_to_jsonl.py  # (éœ€è‡ªè¡Œç¼–å†™)
   ```

---

## æœ€ä½³å®è·µ

### âœ… æ¨èåšæ³•

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå¯ç”¨è‡ªåŠ¨æ¸…ç†ï¼ˆé»˜è®¤ï¼‰
   ```bash
   # æ— éœ€é¢å¤–é…ç½®ï¼Œé»˜è®¤è¡Œä¸ºå³å¯
   python scripts/import_eyeuc_jsonl_to_mysql.py "per_list_output/*.jsonl"
   ```

2. **å®šæœŸç›‘æ§ç£ç›˜ç©ºé—´**ï¼š
   ```bash
   # æ£€æŸ¥ per_list_output å¤§å°
   du -sh per_list_output/
   
   # å¦‚æœå‘ç°å¼‚å¸¸å¢é•¿ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¯¼å…¥å¤±è´¥
   ls -lh per_list_output/
   ```

3. **è‡ªåŠ¨åŒ–ä»»åŠ¡æ—¥å¿—**ï¼š
   ```bash
   # æ£€æŸ¥æœ€è¿‘çš„å®šæ—¶ä»»åŠ¡æ—¥å¿—
   tail -100 logs/scheduled/run_*.log | grep "æ¸…ç†"
   ```

---

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡å¯¼å…¥**ï¼š
   - å¦‚æœæ˜¯é¦–æ¬¡å¤§æ‰¹é‡å¯¼å…¥ï¼Œå»ºè®®å…ˆå¤‡ä»½
   - æˆ–è€…ä½¿ç”¨ `CLEANUP=false` ç¦ç”¨æ¸…ç†
   - éªŒè¯æ•°æ®æ­£ç¡®åå†å¯ç”¨æ¸…ç†

2. **è°ƒè¯•é˜¶æ®µ**ï¼š
   - å¼€å‘å’Œè°ƒè¯•æ—¶å»ºè®®ç¦ç”¨æ¸…ç†
   - ä¾¿äºæ£€æŸ¥åŸå§‹æ•°æ®å’Œæ’æŸ¥é—®é¢˜

3. **ç£ç›˜ç©ºé—´ç´§å¼ æ—¶**ï¼š
   - å¯ç”¨è‡ªåŠ¨æ¸…ç†å¯ä»¥æœ‰æ•ˆèŠ‚çœç©ºé—´
   - å¯¹äº list 182ï¼ˆ100é¡µï¼‰ï¼Œæ¯æ¬¡çº¦ 50MB

---

## ç»Ÿè®¡æ•°æ®

### æ¸…ç†æ•ˆæœ

| åˆ—è¡¨ | é¡µæ•° | æ–‡ä»¶å¤§å° | æ¸…ç†å |
|------|------|----------|--------|
| 182 (NBA2K25) | 100 | ~50 MB | 0 MB |
| 193 (NBA2K26) | 50 | ~25 MB | 0 MB |
| 172 (FIFA) | 35 | ~18 MB | 0 MB |
| 93 (å…¶ä»–) | 31 | ~15 MB | 0 MB |

**æ€»èŠ‚çœ**ï¼šæ¯æ¬¡è‡ªåŠ¨ä»»åŠ¡çº¦ **108 MB**

### å®šæ—¶ä»»åŠ¡ï¼ˆ6 å°æ—¶ä¸€æ¬¡ï¼‰

- æ¯å¤©è¿è¡Œ 4 æ¬¡
- æ¯å¤©ç”Ÿæˆçº¦ 432 MB æ•°æ®
- å¯ç”¨æ¸…ç†åï¼š**0 MB** ç´¯ç§¯ âœ…

---

## æŠ€æœ¯ç»†èŠ‚

### æ ¸å¿ƒä»£ç 

```python
def cleanup_imported_files(files):
    """æ¸…ç†å·²æˆåŠŸå¯¼å…¥çš„æ–‡ä»¶"""
    if not files:
        return
    
    print("ğŸ§¹ æ¸…ç†å·²å¯¼å…¥çš„æ–‡ä»¶...")
    
    dirs_to_check = set()
    for file_path in files:
        try:
            file_obj = Path(file_path)
            if file_obj.exists():
                os.remove(file_path)
                print(f"  âœ… åˆ é™¤: {file_obj.name}")
                dirs_to_check.add(file_obj.parent)
        except Exception as e:
            print(f"  âš ï¸  åˆ é™¤å¤±è´¥ {Path(file_path).name}: {e}")
    
    # æ£€æŸ¥ç›®å½•æ˜¯å¦ä¸ºç©º
    for dir_path in dirs_to_check:
        try:
            if dir_path.exists() and dir_path.is_dir():
                remaining = list(dir_path.glob('*'))
                if not remaining:
                    print(f"  ğŸ“ ç›®å½•å·²ç©ºï¼Œåˆ é™¤: {dir_path.name}")
                    dir_path.rmdir()
                else:
                    print(f"  ğŸ“ ç›®å½•ä¿ç•™ï¼ˆè¿˜æœ‰ {len(remaining)} ä¸ªæ–‡ä»¶ï¼‰: {dir_path.name}")
        except Exception as e:
            print(f"  âš ï¸  æ£€æŸ¥ç›®å½•å¤±è´¥ {dir_path}: {e}")
    
    print("âœ¨ æ¸…ç†å®Œæˆ\n")
```

### è°ƒç”¨é€»è¾‘

```python
def import_files(glob_pattern, auto_cleanup=True):
    files = glob.glob(glob_pattern)
    import_success = False
    
    try:
        # å¯¼å…¥æ•°æ®...
        conn.commit()
        import_success = True
        
        # è‡ªåŠ¨æ¸…ç†
        if import_success and auto_cleanup:
            cleanup_imported_files(files)
        
        return True
    except Exception as e:
        conn.rollback()
        raise
```

---

## æ€»ç»“

### ä¼˜ç‚¹ âœ…

1. **é˜²æ­¢ç£ç›˜ç©ºé—´ç´¯ç§¯**
2. **å…¨è‡ªåŠ¨åŒ–**ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤
3. **å®‰å…¨**ï¼šåªæ¸…ç†æˆåŠŸå¯¼å…¥çš„æ–‡ä»¶
4. **å¯é…ç½®**ï¼šå¯éšæ—¶ç¦ç”¨

### é€‚ç”¨åœºæ™¯ ğŸ¯

- âœ… ç”Ÿäº§ç¯å¢ƒå®šæ—¶ä»»åŠ¡
- âœ… è‡ªåŠ¨åŒ– CI/CD æµç¨‹
- âœ… ç£ç›˜ç©ºé—´æœ‰é™çš„æœåŠ¡å™¨
- âœ… ä¸éœ€è¦ä¿ç•™åŸå§‹ JSONL çš„åœºæ™¯

### ä¸é€‚ç”¨åœºæ™¯ â›”

- âŒ éœ€è¦é•¿æœŸä¿ç•™åŸå§‹æ•°æ®
- âŒ è°ƒè¯•å’Œå¼€å‘é˜¶æ®µ
- âŒ éœ€è¦å¤šæ¬¡å¯¼å…¥åŒä¸€æ–‡ä»¶

**å»ºè®®**ï¼šæ ¹æ®å®é™…éœ€æ±‚çµæ´»é…ç½® `CLEANUP` ç¯å¢ƒå˜é‡ ğŸš€

